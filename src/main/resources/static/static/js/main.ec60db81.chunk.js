(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{182:function(e,n,t){"use strict";t.r(n);var r,a,o,i,c,s,u,d,l,h,j,b,f,p,g,m,x,O=t(0),v=t.n(O),y=t(33),w=t.n(y),C=(t(78),t(7)),S=t(34),_=t(22),k=t(10),L=t(3),I=function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},E={_url:"",_validateStringField:function(e,n){if("string"!==typeof n||!n.trim().length)throw Error("".concat(e," is not valid"))},_validateEmail:function(e){if(!I(e))throw Error("".concat(e," is not a valid email"))},_username:function(e){if("undefined"===typeof e)return sessionStorage.getItem("username");sessionStorage.setItem("username",e)},_token:function(e){if("undefined"===typeof e)return sessionStorage.getItem("token");sessionStorage.setItem("token",e)},isLoggedIn:function(){return!(!this._username()||!this._token())},register:function(e,n,t,r,a,o){var i=this;return Promise.resolve().then((function(){return i._validateStringField("username",e),i._validateEmail(n),i._validateStringField("password",t),i._validateStringField("studentId",r),i._validateStringField("firstName",a),i._validateStringField("lastName",o),fetch("".concat(i._url,"/register"),{method:"POST",body:JSON.stringify({username:e,email:n,password:t,studentId:r,firstName:a,lastName:o}),headers:{"content-type":"application/json"}}).then((function(e){return 201===e.status?e:e.json().then((function(e){var n=e.message;throw Error(n)}))})).then((function(e){return e.json()})).then((function(){return!0}))}))},login:function(e,n){var t=this;return Promise.resolve().then((function(){return t._validateStringField("username",e),t._validateStringField("password",n),fetch("".concat(t._url,"/authenticate"),{method:"POST",body:JSON.stringify({username:e,password:n}),headers:{"content-type":"application/json"}}).then((function(e){return 200===e.status?e:e.json().then((function(e){var n=e.message;throw Error(n)}))})).then((function(e){return e.json()})).then((function(e){return t._token(e.jwt),t._username(e.username),!0}))}))},logout:function(){return Promise.resolve().then((function(){return sessionStorage.clear(),!0}))},retrieveUser:function(){return fetch("".concat(this._url,"/user/").concat(this._username()),{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer ".concat(this._token())}}).then((function(e){return 200===e.status?e:e.json().then((function(e){var n=e.message;throw Error(n)}))})).then((function(e){return e.json()})).then((function(e){return e}))}},P=t(1),F=Object(O.createContext)(),R=Object(O.createContext)(),T="update",D="login_success",N="login_error",z="logout",A="user_loaded",M="user_load_failed",U="clear_errors",B="error",H=(r={},Object(k.a)(r,T,(function(e,n){var t=n.payload,r=t.name,a=t.value;return Object(L.a)(Object(L.a)({},e),{},Object(k.a)({},r,a))})),Object(k.a)(r,D,(function(e){return Object(L.a)(Object(L.a)({},e),{},{isLoggedIn:!0})})),Object(k.a)(r,A,(function(e,n){return Object(L.a)(Object(L.a)({},e),{},{userData:n.payload.userData})})),Object(k.a)(r,N,(function(e,n){var t=n.payload.error;return Object(L.a)(Object(L.a)({},e),{},{isLoggedIn:!1,error:t})})),Object(k.a)(r,z,(function(){return{name:"",password:"",error:"",isLoggedIn:!1}})),Object(k.a)(r,B,(function(e,n){var t=n.payload.error;return Object(L.a)(Object(L.a)({},e),{},{error:t})})),Object(k.a)(r,M,(function(e,n){var t=n.payload.error;return Object(L.a)(Object(L.a)({},e),{},{error:t})})),Object(k.a)(r,U,(function(e){return Object(L.a)(Object(L.a)({},e),{},{error:""})})),r),J={isLoggedIn:E.isLoggedIn(),token:E._token(),username:"",email:"",password:"",userData:void 0,error:""},G=function(e,n){return H[n.type](e,n)||e},Z=function(e){var n=e.children,t=Object(O.useReducer)(G,J),r=Object(_.a)(t,2),a=r[0],o=r[1],i=function(){var e=a.username,n=a.password;E.login(e,n).then((function(){o({type:D})})).catch((function(e){var n=e.message;o({type:N,payload:{error:n}})}))},c={onUpdate:function(e){var n=e.target.name,t=e.target.value;o({type:T,payload:{name:n,value:t}})},onRegister:function(e,n,t){var r=a.username,c=a.email,s=a.password;E.register(r,c,s,e,n,t).then((function(){return i()})).catch((function(e){var n=e.message;o({type:B,payload:{error:n}})}))},onLogin:i,onLogout:function(){E.logout().then((function(){o({type:z})}))},onLoadUserData:function(){E.retrieveUser().then((function(e){o({type:A,payload:{userData:e}})})).catch((function(e){var n=e.message;o({type:M,payload:{error:n}})}))},onClearErrors:function(){o({type:U})}};return Object(P.jsx)(F.Provider,{value:a,children:Object(P.jsx)(R.Provider,{value:c,children:n})})},Y=function(){var e=Object(O.useContext)(F);if(void 0===e)throw new Error("useAuthState must be used within a AuthProvider");return e},$=function(){var e=Object(O.useContext)(R);if(void 0===e)throw new Error("useAuthDispatch must be used within a AuthProvider");return e},q=t(4),K=t(5),Q=K.a.div(a||(a=Object(q.a)(["\n  width: 100vw;\n  height: 100vh;\n"]))),V=t(35),W=function(e){var n=e.children,t=e.redirectTo,r=Object(V.a)(e,["children","redirectTo"]),a=Y().isLoggedIn;return Object(P.jsx)(C.b,Object(L.a)(Object(L.a)({},r),{},{render:function(){return a?n:Object(P.jsx)(C.a,{to:t})}}))},X=t(72),ee=t.n(X),ne=t(73),te=t.n(ne),re=K.a.div(o||(o=Object(q.a)(["\n  position: relative;\n  text-align: left;\n  height: 100%;\n  background: rgb(220, 220, 220);\n  opacity: 0.8;\n\n  ul {\n    list-style: none;\n    padding: 15px;\n    margin: 0;\n    border: 1px solid rgb(180, 180, 180);\n    height: 100%;\n    overflow-y: scroll;\n    width: 50vw;\n    height: 50vh;\n  }\n\n  p {\n    font-size: 22px;\n    padding: 5px 0;\n  }\n\n  h1 {\n    font-weight: 300;\n  }\n"]))),ae=K.a.li(i||(i=Object(q.a)(["\n  height: 80px;\n  height: auto;\n  width: 100%;\n  padding: 1em;\n  text-align: ",";\n"])),(function(e){return e.isMe?"right":"left"})),oe=K.a.div(c||(c=Object(q.a)(["\n  padding: 1em;\n  border-radius: 10px;\n  background: ",";\n  color: ",";\n  text-align: ",";\n"])),(function(e){return e.isMe?"var(--primary-color)":"rgba(200, 200, 200)"}),(function(e){return e.isMe?"white":""}),(function(e){return e.isMe?"right":"left"})),ie=K.a.div(s||(s=Object(q.a)(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  box-shadow: 0px 4px 8px 0px rgba(122,122,122,1);\n"]))),ce=K.a.h1(u||(u=Object(q.a)(["\n  display: flex;\n  align-items: center;\n  background: var(--primary-color);\n  color: white;\n  padding: 1em;\n\n  button {\n    background: darkred;\n    font-size: 16px;\n  }\n\n  button:hover {\n    background: rgb(180, 0, 0);\n  }\n"]))),se=K.a.form(d||(d=Object(q.a)(["\n  display: flex;\n  margin: 1em 0;\n"]))),ue=K.a.div(l||(l=Object(q.a)(["\n  background: white;\n  padding: 2em;\n  border-radius: 5px;\n\n  textarea {\n    flex: 4;\n    border: 1px solid rgb(180, 180, 180);\n    width: 100%;\n    resize: none;\n    font-size: 16px;\n    padding: 10px;\n  }\n\n  button {\n    flex: 1;\n    margin: 0;\n  }\n\n  textarea:focus {\n    outline: none;\n  }\n"]))),de=K.a.textarea(h||(h=Object(q.a)(["\n  \n"]))),le=function(e){var n=Object.assign({},e);return Object(P.jsx)(O.Fragment,{children:Object(P.jsx)(de,Object(L.a)({},n))})},he=K.a.button(j||(j=Object(q.a)(["\n\tpadding: 10px 20px;\n\tfont-size: 1em;\n\tmargin: 10px 0;\n\twidth: 100%;\n\toutline: none;\n\tborder: none;\n\tbackground-color: var(--primary-color);\n\tcolor: white;\n\ttransition: all .3s ease-out;\n\n\t:hover {\n\t\tbackground-color: var(--primary-color-hover);\n\t\tcursor: pointer;\n\t}\n\n\t:active {\n\t\tbackground-color: var(--primary-color);\n\t}\n"]))),je=function(e){return Object(P.jsx)(he,Object(L.a)(Object(L.a)({},e),{},{children:e.children}))},be={_url:"",loadChat:function(e,n){return fetch("".concat(this._url,"/history/").concat(e),{method:"GET",headers:{"content-type":"application/json",authorization:"Bearer ".concat(n)}}).then((function(e){return 200===e.status?e:e.json().then((function(e){var n=e.message;throw Error(n)}))})).then((function(e){return e.json()})).then((function(e){return e}))}},fe=Object(O.createContext)(),pe=Object(O.createContext)(),ge="chat_loaded",me="chat_load_failed",xe={chatHistory:[],isChatLoaded:!1},Oe=(b={},Object(k.a)(b,ge,(function(e,n){return Object(L.a)(Object(L.a)({},e),{},{chatHistory:n.payload.chatHistory,isChatLoaded:!0})})),Object(k.a)(b,me,(function(e,n){var t=n.payload.error;return Object(L.a)(Object(L.a)({},e),{},{error:t})})),b),ve=function(e,n){return Oe[n.type](e,n)||e},ye=function(e){var n=e.children,t=Object(O.useReducer)(ve,xe),r=Object(_.a)(t,2),a=r[0],o=r[1],i={onLoadChat:function(e){be.loadChat("main",sessionStorage.getItem("token")).then((function(e){o({type:ge,payload:{chatHistory:e}})})).catch((function(e){var n=e.message;o({type:me,payload:{error:n}})}))}};return Object(P.jsx)(fe.Provider,{value:a,children:Object(P.jsx)(pe.Provider,{value:i,children:n})})},we="".concat(window.location.origin,"/ws"),Ce=function(){var e=Object(O.useRef)(),n=Object(O.useState)(""),t=Object(_.a)(n,2),r=t[0],a=t[1],o=function(){var e=Object(O.useContext)(fe);if(void 0===e)throw new Error("useChatState must be used within a ChatProvider");return e}(),i=o.chatHistory,c=o.isChatLoaded,s=function(){var e=Object(O.useContext)(pe);if(void 0===e)throw new Error("useChatDispatch must be used within a ChatProvider");return e}().onLoadChat,u=$().onLogout,d=Y(),l=d.userData,h=d.token;Object(O.useEffect)((function(){c||s()}),[s,c]);var j=function(e){return e.from.split(" ")[0]===l.firstName},b=l?l.firstName+" "+l.lastName:"";return l?Object(P.jsxs)(re,{children:[Object(P.jsx)(ee.a,{headers:{Authorization:"Bearer ".concat(h)},url:we,topics:["/topic/message/main"],onConnect:function(){S.b.info("You are now connected to chat session.",{position:"top-right",autoClose:5e3,hideProgressBar:!0})},onMessage:function(e){s()},onConnectFailure:function(e){throw console.log("Cannot connect to server. please try to reconnect again."),e},debug:!1,ref:e}),Object(P.jsxs)(ie,{children:[Object(P.jsxs)(ce,{children:[Object(P.jsxs)("div",{style:{flex:"10"},children:["SIT CHAT - ",b]}),Object(P.jsx)(je,{style:{flex:"1"},onClick:u,children:"Logout"})]}),Object(P.jsxs)(ue,{children:[Object(P.jsx)("ul",{children:i.map((function(e,n){return Object(P.jsx)(ae,{children:Object(P.jsxs)(oe,{isMe:j(e),children:[j(e)?"":Object(P.jsxs)("h4",{children:[e.from,":"]}),Object(P.jsx)("p",{children:e.content}),Object(P.jsx)("p",{style:{textAlign:j(e)?"left":"right",fontSize:"14px"},children:te()(parseInt(e.dateTime)).fromNow()})]})})}))}),Object(P.jsxs)(se,{onSubmit:function(n){n.preventDefault(),r&&(e.current.sendMessage("/app/message/main",JSON.stringify({from:b,to:"main",content:r,dateTime:(new Date).getTime().toString()})),a(""))},children:[Object(P.jsx)(le,{cols:"60",rows:"5",placeholder:"Enter your message",onChange:function(e){var n=e.target.value;a(n)},value:r}),Object(P.jsx)(je,{type:"submit",children:"Send"})]})]})]})]}):Object(P.jsx)(O.Fragment,{})},Se=t(17),_e=K.a.div(f||(f=Object(q.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  text-align: center;\n  height: 100%;\n  background: rgb(220, 220, 220);\n\n  a {\n    text-decoration: none;\n    color: var(--primary-color);\n    transition: all .3s ease-out;\n  }\n\n  a:hover {\n    color: var(--primary-color-hover);\n    transform: scale(1.01);\n  }\n\n  h1 {\n    font-weight: 300;\n    padding: 1em 0;\n  }\n"]))),ke=K.a.div(p||(p=Object(q.a)(["\n  max-width: 1020px;\n  background: white;\n  padding: 2em;\n  border-radius: 5px;\n  box-shadow: 0px 4px 8px 0px rgba(122,122,122,1);\n"]))),Le=K.a.form(g||(g=Object(q.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),Ie=K.a.input(m||(m=Object(q.a)(["\n\tdisplay: block;\n\tpadding: 0.5em 1em;\n\tmargin: 5px 0;\n\twidth: 300px;\n\theight: 40px;\n\tborder: 1px solid rgba(0, 0, 0, 0.2);\n\tborder-bottom: 2px solid ",";\n\ttransition: all .3s ease-out;\n\tfont-size: 1em;\n\n\t:focus {\n\t\toutline: none;\n\t\tborder-bottom-color: ",";\n\t\tbox-shadow: var(--inner-shadow);\n\t}\n"])),(function(e){return e.invalid?"red":"rgba(0, 0, 0, 0.2)"}),(function(e){return e.invalid?"red":"rgba(0, 0, 0, 0.2)"})),Ee=K.a.span(x||(x=Object(q.a)(["\n\ttext-align: left;\n\tcolor: red;\n\twidth: 100%;\n\tfont-size: 14px;\n"]))),Pe=function(e){var n=e.invalidMsg,t=Object(V.a)(e,["invalidMsg"]);return Object(P.jsxs)(O.Fragment,{children:[Object(P.jsx)(Ie,Object(L.a)(Object(L.a)({},t),{},{ref:t.innerRef,invalid:""!==n})),Object(P.jsx)(Ee,{children:n})]})};Pe.defaultProps={invalidMsg:""};var Fe,Re,Te,De=Pe,Ne=function(){var e=$(),n=e.onUpdate,t=e.onLogin,r=Y(),a=r.username,o=r.password;return Object(P.jsx)(_e,{children:Object(P.jsxs)(ke,{children:[Object(P.jsx)("h1",{children:"SIT CHAT"}),Object(P.jsxs)(Le,{onSubmit:function(e){e.preventDefault(),t()},children:[Object(P.jsxs)("div",{children:[Object(P.jsx)(De,{name:"username",value:a||"",type:"text",placeholder:"Username",onChange:n}),Object(P.jsx)(De,{name:"password",value:o||"",type:"password",placeholder:"Password",onChange:n})]}),Object(P.jsx)(je,{type:"submit",children:"Login"}),Object(P.jsx)(Se.b,{to:"/register",children:"I don't have an account yet."})]})]})})},ze=K.a.div(Fe||(Fe=Object(q.a)(["\ndisplay: flex;\njustify-content: center;\nalign-items: center;\ntext-align: center;\nheight: 100%;\nbackground: rgb(220, 220, 220);\n\na {\n  text-decoration: none;\n  color: var(--primary-color);\n  transition: all .3s ease-out;\n}\n\na:hover {\n  color: var(--primary-color-hover);\n  transform: scale(1.01);\n}\n\nh1 {\n  font-weight: 300;\n  padding: 1em 0;\n}\n"]))),Ae=K.a.div(Re||(Re=Object(q.a)(["\n  max-width: 1020px;\n  background: white;\n  padding: 2em;\n  border-radius: 5px;\n  box-shadow: 0px 4px 8px 0px rgba(122,122,122,1);\n"]))),Me=K.a.form(Te||(Te=Object(q.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),Ue=function(){var e=$(),n=e.onUpdate,t=e.onRegister,r=Y(),a=r.username,o=r.password,i=r.email,c=Object(O.useRef)(),s=Object(O.useRef)(),u=Object(O.useRef)(),d=Object(O.useRef)();return Object(P.jsx)(ze,{children:Object(P.jsxs)(Ae,{children:[Object(P.jsx)("h1",{children:"REGISTER"}),Object(P.jsxs)(Me,{onSubmit:function(e){e.preventDefault(),u.current.value===o&&t(d.current.value,c.current.value,s.current.value)},children:[Object(P.jsxs)("div",{style:{marginBottom:"8px"},children:[Object(P.jsx)(De,{name:"username",value:a||"",type:"text",placeholder:"Username",onChange:n}),Object(P.jsx)(De,{name:"password",value:o||"",type:"password",placeholder:"Password",onChange:n}),Object(P.jsx)(De,{name:"confirmPassword",innerRef:u,type:"password",placeholder:"Confirm Password"})]}),Object(P.jsxs)("div",{children:[Object(P.jsx)(De,{name:"firstName",innerRef:c,type:"text",placeholder:"First Name"}),Object(P.jsx)(De,{name:"lastName",innerRef:s,type:"text",placeholder:"Last Name"}),Object(P.jsx)(De,{name:"studentId",innerRef:d,type:"text",placeholder:"Student ID"}),Object(P.jsx)(De,{name:"email",value:i||"",type:"email",placeholder:"Email",onChange:n})]}),Object(P.jsx)(je,{type:"submit",children:"Register"}),Object(P.jsx)(Se.b,{to:"/login",children:"Already have an account? Login"})]})]})})},Be=(t(181),function(){var e=$(),n=e.onClearErrors,t=e.onLoadUserData,r=Y(),a=r.error,o=r.isLoggedIn,i=r.userData,c=Object(C.g)();return Object(O.useEffect)((function(){var e=c.listen((function(){a&&n()}));return o&&!i&&t(),function(){return e()}}),[c,a,n,o,i,t]),Object(P.jsxs)(Q,{children:[Object(P.jsxs)(C.d,{children:[Object(P.jsx)(W,{exact:!0,path:"/",redirectTo:"/login",children:Object(P.jsx)(Ce,{})}),Object(P.jsx)(C.b,{exact:!0,path:"/login",children:o?Object(P.jsx)(C.a,{to:"/"}):Object(P.jsx)(Ne,{})}),Object(P.jsx)(C.b,{exact:!0,path:"/register",children:o?Object(P.jsx)(C.a,{to:"/"}):Object(P.jsx)(Ue,{})})]}),Object(P.jsx)(S.a,{})]})}),He=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,183)).then((function(n){var t=n.getCLS,r=n.getFID,a=n.getFCP,o=n.getLCP,i=n.getTTFB;t(e),r(e),a(e),o(e),i(e)}))};w.a.render(Object(P.jsx)(v.a.StrictMode,{children:Object(P.jsx)(Z,{children:Object(P.jsx)(ye,{children:Object(P.jsx)(Se.a,{children:Object(P.jsx)(Be,{})})})})}),document.getElementById("root")),He()},78:function(e,n,t){}},[[182,1,2]]]);
//# sourceMappingURL=main.ec60db81.chunk.js.map